# Baseline configuration for 24h ECG dataset with class weights for intervals (10 classes)
# This config is specifically for the 24h dataset (P1): data/icu_ecgs_24h/P1
# Uses intervals binning strategy (10 classes: [0,1), [1,2), ..., [9, +inf))
# Class weights are calculated based on the class distribution of this dataset
# 
# IMPORTANT: This config is dataset-specific. Do not use for other datasets!
#
# MODEL-AGNOSTIC: This config can be used with any model by combining it with
# the appropriate model config (e.g., cnn_scratch.yaml, resnet1d_14_scratch.yaml, etc.)
# The model's num_classes will be automatically set to 10 based on los_binning settings.

# Random seed for reproducibility
seed: 42

# Device settings
device:
  device: null  # null = auto-select (CUDA if available, else CPU)
  deterministic: false

# Data settings for 24h dataset
data:
  data_dir: "data/icu_ecgs_24h/P1"
  sampling_rate: 500.0  # Hz
  window_seconds: 10.0  # seconds
  num_leads: 12  # 12-lead ECG
  
  # LOS binning strategy - intervals with 10 classes
  los_binning:
    strategy: "intervals"  # "intervals" (old 10-class) or "exact_days" (new, e.g., 8-class)
    max_days: 9  # Only used for "exact_days" strategy (not used for intervals)
  
  # Preprocessing (same as baseline)
  preprocessing:
    target_sampling_rate: 500.0
    window_seconds: 10.0
    filter_type: "bandpass"
    filter_lowcut: 0.5
    filter_highcut: 50.0
    filter_order: 4
    normalize: "zscore"
  
  # Data augmentation - ENABLED
  augmentation:
    enabled: true
    gaussian_noise: true
    noise_std: 0.03
    amplitude_scaling: true
    scale_min: 0.85
    scale_max: 1.15

# Training hyperparameters
training:
  batch_size: 64
  num_epochs: 50
  num_workers: 4
  pin_memory: true
  
  # Optimizer
  optimizer:
    type: "Adam"
    lr: 5e-4
    weight_decay: 1e-4
    betas: [0.9, 0.999]
  
  # Gradient clipping
  gradient_clip_norm: 1.0
  
  # Dropout rate
  dropout_rate: 0.3
  
  # Learning rate scheduler
  scheduler:
    type: "ReduceLROnPlateau"
    factor: 0.1
    patience: 5
    min_lr: 1e-6
  
  # Loss function with class weights for 24h dataset (intervals, 10 classes)
  # Weights calculated based on training set distribution (28,147 samples):
  # Class distribution: [4367, 9294, 4985, 2848, 1781, 1063, 808, 506, 448, 2047]
  # Method: balanced weights (n_samples / (n_classes * count[i]))
  # Normalized so mean = 1.0
  loss:
    type: "weighted_ce"
    enabled: true  # Set to false to disable weighted classes (useful for balanced datasets)
    weight: [0.3, 0.1, 0.2, 0.4, 0.7, 1.1, 1.5, 2.4, 2.7, 0.6]  # 10 classes for intervals
  # Class 0: 0.28 (4,367 samples, 15.51%)
  # Class 1: 0.13 (9,294 samples, 33.02%)
  # Class 2: 0.24 (4,985 samples, 17.71%)
  # Class 3: 0.42 (2,848 samples, 10.12%)
  # Class 4: 0.67 (1,781 samples, 6.33%)
  # Class 5: 1.13 (1,063 samples, 3.78%)
  # Class 6: 1.49 (808 samples, 2.87%)
  # Class 7: 2.37 (506 samples, 1.80%)
  # Class 8: 2.68 (448 samples, 1.59%)
  # Class 9: 0.59 (2,047 samples, 7.27%)

# Validation settings
validation:
  val_split: 0.1  # 10% for 80-10-10 split
  val_frequency: 1

# Test settings
test_split: 0.1  # 10% for 80-10-10 split

# Early stopping
early_stopping:
  enabled: true
  patience: 7
  monitor: "val_loss"
  mode: "min"

# Checkpointing
checkpoint:
  save_dir: "outputs/checkpoints"
  save_frequency: 1
  save_best: true
  metric: "val_loss"

# Logging
logging:
  log_dir: "outputs/logs"
  use_tensorboard: true
  log_frequency: 10

# Evaluation metrics
evaluation:
  metrics:
    - "accuracy"
    - "f1_score"
    - "precision"
    - "recall"
    - "auc_roc"
    - "auc_pr"

# Multi-task learning settings (LOS + Mortality)
multi_task:
  enabled: true
  admissions_path: "data/labeling/labels_csv/admissions.csv"
  los_loss_weight: 1.0
  mortality_loss_weight: 1.0
  mortality_use_weighted_loss: true  # Weighted BCE for mortality (class imbalance: 92.3% vs 7.7%)
  mortality_pos_weight: 12.05  # pos_weight = num_negative / num_positive = 25961 / 2155

