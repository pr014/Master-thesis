# Configuration for 24h ECG dataset for LOS REGRESSION
# This config is specifically for the 24h dataset (P1): data/icu_ecgs_24h/P1
# 
# IMPORTANT: This is a LOS REGRESSION config!
# LOS values are continuous (days), not binned into classes.
#
# MODEL-AGNOSTIC: This config can be used with any model by combining it with
# the appropriate model config (e.g., cnn_scratch.yaml, deepecg_sl.yaml, etc.)

# Random seed for reproducibility
seed: 42

# Device settings
device:
  device: null  # null = auto-select (CUDA if available, else CPU)
  deterministic: false

# Data settings for 24h dataset
data:
  data_dir: "data/icu_ecgs_24h/P1"
  sampling_rate: 500.0  # Hz
  window_seconds: 10.0  # seconds
  num_leads: 12  # 12-lead ECG
  
  # LOS task type: REGRESSION
  # LOS values are continuous (days), not binned into classes
  los_task: "regression"  # "regression" or "classification"
  
  # Preprocessing (same as baseline)
  preprocessing:
    target_sampling_rate: 500.0
    window_seconds: 10.0
    filter_type: "bandpass"
    filter_lowcut: 0.5
    filter_highcut: 50.0
    filter_order: 4
    normalize: "zscore"
  
  # Data augmentation - ENABLED
  augmentation:
    enabled: true
    gaussian_noise: true
    noise_std: 0.03
    amplitude_scaling: true
    scale_min: 0.85
    scale_max: 1.15

# Training hyperparameters
training:
  batch_size: 32  # Reduced for DeepECG-SL (larger model)
  num_epochs: 50
  num_workers: 4
  pin_memory: true
  
  # Optimizer
  optimizer:
    type: "Adam"
    lr: 5e-4
    weight_decay: 1e-4
    betas: [0.9, 0.999]
  
  # Gradient clipping
  gradient_clip_norm: 1.0
  
  # Dropout rate
  dropout_rate: 0.3
  
  # Learning rate scheduler
  scheduler:
    type: "ReduceLROnPlateau"
    factor: 0.1
    patience: 5
    min_lr: 1e-6
  
  # Loss function - MSE for LOS REGRESSION
  loss:
    type: "mse"  # "mse" (Mean Squared Error) or "l1" (Mean Absolute Error) for regression
    # Note: For classification tasks, use "cross_entropy", "focal", or "weighted_ce"

# Validation settings
validation:
  val_split: 0.1  # 10% for 80-10-10 split
  val_frequency: 1

# Test settings
test_split: 0.1  # 10% for 80-10-10 split

# Early stopping
early_stopping:
  enabled: true
  patience: 7
  monitor: "val_loss"  # Options: "val_loss", "val_los_mae" for regression
  mode: "min"  # "min" for loss/MAE

# Checkpointing
checkpoint:
  save_dir: "outputs/checkpoints"
  save_frequency: 1
  save_best: true
  metric: "val_loss"

# Logging
logging:
  log_dir: "outputs/logs"
  use_tensorboard: true
  log_frequency: 10

# Evaluation metrics for REGRESSION
evaluation:
  metrics:
    - "mae"  # Mean Absolute Error
    - "rmse"  # Root Mean Squared Error
    - "r2"  # RÂ² Score
    - "median_ae"  # Median Absolute Error
    # Mortality metrics (binary classification)
    - "accuracy"  # For mortality
    - "auc_roc"  # For mortality

# Multi-task learning settings (LOS Regression + Mortality Classification)
multi_task:
  enabled: true
  admissions_path: "data/labeling/labels_csv/admissions.csv"
  los_loss_weight: 1.0  # Weight for LOS REGRESSION loss (MSE)
  mortality_loss_weight: 1.0  # Weight for mortality prediction loss (BCE)
  mortality_use_weighted_loss: true  # Weighted BCE for mortality (class imbalance: 92.3% vs 7.7%)
  mortality_pos_weight: 12.05  # pos_weight = num_negative / num_positive = 25961 / 2155
